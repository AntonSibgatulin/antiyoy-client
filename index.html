
<html>
<head><title>Chess Online</title>
    <meta charset="UTF-8">
     
        
 <!--    <link rel="stylesheet" href="css/style.css"> -->
 <style>

.boardList{
height:10%; 
    margin-right: 3px;
    margin-left:3px;
    border-radius: 10px 10px 10px 10px;
    margin-bottom: 8px; 
    border: 3px solid #2bd2e4;
    background-color: white;
width: 99%;
    
}
.last{
    height: 100%;
    width: 100%;
    background-color: red;
    float: left;
display: flex;
align-items: center;
justify-content: center;
}
.end{
    height: 100%;
    width: 100%;
    background-color: green;
    float: left;
display: flex;
align-items: center;
justify-content: center;
}
.block:checked{
    background-color: red;
}
.boardList:hover {
    background-color: bisque;
}
html{
    border-radius: 20px 20px 20px 20px;
    border:6px solid #55cdef;
}
.panel{
    
    position: fixed;
    height: 11%;
    display: flex;
 
    border: 9px solid #55b3ce;
    width: 100%;
    bottom: 0%;
    align-items: center;
    background-color: #55b3ce;
    right: 0%;
    left: 0%;
    
}

.createtable{
    margin-left:6%;
    font-size: 90%;
    margin-top: 0%; 
    text-align: center;
    text-justify: center; 
    border-radius: 20px 20px 20px 20px;
  background: linear-gradient(45deg, #477536, #36f552);
    width: 20%;
    height:80%;
}
.join{
    margin-left:12%;
    font-size: 90%;
    margin-top: 0%; 
    text-align: center;
    text-justify: center; 
    border-radius: 20px 20px 20px 20px;
background: linear-gradient(45deg, #477536, #36f552);
    width: 20%;
    height:80%;
}



.view{
    margin-left:12%;
    font-size: 90%;
    margin-top: 0%; 
    text-align: center;
    text-justify: center; 
    border-radius: 20px 20px 20px 20px;
   background: linear-gradient(45deg, #477536, #36f552);
    width: 20%;
    height:80%;
}
.board{
    width: 100%;

        height: calc(80% - 12px);
    border-radius: 10px 10px 10px 10px;
      border: 6px solid #55cdef;
  
    top: 0%;
    left:0px;
    display: flex;
   /* left: calc(20% - 12px); */

    overflow: auto;
    
}
.board::selection{
    background: transparent;
}
body{

    margin-left: 0px;
margin-top: 0px;
}


 .block{   
    display: flex;
    
    align-items: center;
    border: 1px solid grey;
    justify-content: center;
        width: 25px;
    height: 25px;
    
    }
    /*
    .block{
   
    display: flex;
    
    align-items: center;
    border: 1px solid grey;
    justify-content: center;
        width: 45px;
    height: 45px;
    
    }
*/

    .block:hover{
        background-color: #b7a78e;
    }


    @media screen and (min-width: 600px) {
 
.block{
     
    display: flex;
    
    align-items: center;
    border: 1px solid grey;
    justify-content: center;
        width: 45px;
    height: 45px;
    
    }
}


.black{
    background-color: #b58863;
}
.white{
    background-color: #f0d9b5;
}



.none{
    background-color: #f0d9b5;
}







.aqua{
    background-color: #281cdcbf;
}

.fiolet{
    background-color: #7f20d2;
}

.blue{
    background-color: #722aff7a;
}
.green{
    background-color: #1cdc3cbf;
}
.yellow{
    background-color: #dacb1bbf;
}
.red{
    background-color: #d2542e;
}


.blue{
    background-color: #5c20d2;
}


.pink{
    background-color: #d220bc;
}







.figure{
    font-size: 200%;
    cursor:pointer;


}
 </style>
    </head>

    
   
    <body>

<link rel="stylesheet" href="css/1.css" />

		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0a2/jquery.mobile-1.0a2.min.css" />

<script src="js/1.js"></script>

<script src="js/2.js"></script>

<script src="js/3.js"></script>

<script src="js/4.js"></script>


<script src="http://code.jquery.com/jquery-1.4.4.min.js"></script>
<script src="http://code.jquery.com/mobile/1.0a2/jquery.mobile-1.0a2.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.12.4.js"></script>
<script src="http://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script>
! function(a) {
    function f(a, b) {
        if (!(a.originalEvent.touches.length > 1)) {
            a.preventDefault();
            var c = a.originalEvent.changedTouches[0],
                d = document.createEvent("MouseEvents");
            d.initMouseEvent(b, !0, !0, window, 1, c.screenX, c.screenY, c.clientX, c.clientY, !1, !1, !1, !1, 0, null), a.target.dispatchEvent(d)
        }
    }
    if (a.support.touch = "ontouchend" in document, a.support.touch) {
        var e, b = a.ui.mouse.prototype,
            c = b._mouseInit,
            d = b._mouseDestroy;
        b._touchStart = function(a) {
            var b = this;
            !e && b._mouseCapture(a.originalEvent.changedTouches[0]) && (e = !0, b._touchMoved = !1, f(a, "mouseover"), f(a, "mousemove"), f(a, "mousedown"))
        }, b._touchMove = function(a) {
            e && (this._touchMoved = !0, f(a, "mousemove"))
        }, b._touchEnd = function(a) {
            e && (f(a, "mouseup"), f(a, "mouseout"), this._touchMoved || f(a, "click"), e = !1)
        }, b._mouseInit = function() {
            var b = this;
            b.element.bind({
                touchstart: a.proxy(b, "_touchStart"),
                touchmove: a.proxy(b, "_touchMove"),
                touchend: a.proxy(b, "_touchEnd")
            }), c.call(b)
        }, b._mouseDestroy = function() {
            var b = this;
            b.element.unbind({
                touchstart: a.proxy(b, "_touchStart"),
                touchmove: a.proxy(b, "_touchMove"),
                touchend: a.proxy(b, "_touchEnd")
            }), d.call(b)
        }
    }
}(jQuery);    
</script>
       
        <script >
                 var connection = new WebSocket('ws://192.168.0.107:4999');

    var touch = new Array();

var boardi = '  <div  id ="sid" onClick="onShow(this)" style="float:left;display:flex;" class="boardList"><div style="display:flex;width:25%;margint-top:20%;font-size:95%;align-item:center;justify-content: center;align-items: center;">name</div><div style="display:flex;width:25%;margint-top:20%;font-size:95%;align-item:center;justify-content: center;align-items: center;">stavka$</div> <div style="width:25%;font-size:95%;align-items: center;display:flex;">numberpeop </div><div style="font-size:95%;width:25%;display:flex;align-items:center;">long min </div></div>';
 var str = '<div id="joined" value="cid" class="join"  style="display: flex;align-items: center;justify-content: center;" onClick="joined(this)"><dt>Войти</div>';
var Side = "none";



var moneygame = 0;
var playergame = 0;
var status = 0;


window.onload = function(){ 
document.getElementById("user").value=""+get_cookie("db");
     document.getElementById("pass").value=""+get_cookie("hash");

    function timer(){

        //var hour = document.getElementById('hour').innerHTML;
        //var minute = document.getElementById('minute').innerHTML;
        var second = document.getElementById('second').innerHTML;
        var end = false;
        
        if( second > 0 ) second--;
        else{
            second = 59;
            
            /*if( minute > 0 ) minute--;
            else{
                second = 59;
                
                if( hour > 0 ) hour--;
                else end = true;
            }*/
        }

        if(end){
            clearInterval(intervalID);
            alert("Таймер сработал!");
        }else{
        //  document.getElementById('hour').innerHTML = hour;
        //  document.getElementById('minute').innerHTML = minute;
            document.getElementById('second').innerHTML = second;
        }
    }
    
    
    
    
    function timerPlayer(){
    var second = document.getElementById('times').innerHTML;
        
        if( second > 0 ) second--;
        else{
            second = 59;
        }
            document.getElementById('times').innerHTML = second;
    }
    //window.intervalID = setInterval(timer, 1000);
    
    function timerPlayer1(){
    var second = document.getElementById('times1').innerHTML;
        
        if( second > 0 ) second--;
        else{
            second = 59;
        }
        //    document.getElementById('times1').innerHTML = second;
    }
  //  window.intervalID = setInterval(timerPlayer1, 1000);
  //  window.interval = setInterval(timerPlayer, 1000);
    
}
function  getChessFigureSide(str,side){
    if(side=="white"){
        switch(str){
            case 'K':return true;
            case 'R':return true;
            case 'N':return true;
            case 'P':return true;
            case 'Q':return true;
            case 'B':return true;
            default:return false;
        }
    }else if(side=="black"){
        switch(str){
            case 'k':return true;
            case 'r':return true;
            case 'n':return true;
            case 'p':return true;
            case 'q':return true;
            case 'b':return true;
            default:return false;
        }
    }else
        return false;
}
    function onShow(e){
      
     var b=   document.getElementsByClassName("join")[0];
        if(b!= null)
            b.remove();
         $('.panel').append(str.replace('joined',e.id));
       
    }
var boardfigureposition="rnbqkbnr"
                       +"pppppppp"
                       +"11111111"
                       +"11111111"
                       +"11111111"
                       +"11R111P1"
                       +"PPPPPP1P"
                       +"RNBQKBN1";
 function create(){
       
     var c = prompt ("Введите имя стола.(необязательное поле)");
     var b = prompt ("Введите ставку.(обязательно,минимум 5$,введите цифру)");
     if(Number(b)>3){
     connection.send("tables;create;"+c+";"+b+";"+get_cookie("db")+";"+get_cookie("hash"));
     }
     else{
         alert("Некорректно была введена ставка ,минимум 5$");
     }
    }
    function joined(e){
   
        connection.send("tables;join;"+e.id+";"+get_cookie("db")+";"+get_cookie("hash"));
    }
   
function auth(e){
    var a  = document.getElementById("user").value;
     var b  = document.getElementById("pass").value;
      
       
    connection.send("auth;"+a+";"+b);
    
            
}

function get_cookie ( cookie_name )
{
  var results = document.cookie.match ( '(^|;) ?' + cookie_name + '=([^;]*)(;|$)' );
 
  if ( results )
    return ( unescape ( results[2] ) );
  else
    return "";
}
function initBoardLists(cool,number,stavcka,time,name){
       $('#boardlistview').append(boardi.replace('sid',cool)
                       .replace('stavka',stavcka)
                        .replace('number',number)
                       .replace('long',time/60000)
                                 .replace('name',name));
       
   
}

function initBoardLists1(id,level,time,size){
    $('#boardlistview').append(boardi.replace('sid',id));
}



var figures = "";
 var updates = '<div style="display:flex;width:25%;margint-top:20%;font-size:95%;align-item:center;justify-content: center;align-items: center;">name</div><div style="display:flex;width:25%;margint-top:20%;font-size:95%;align-item:center;justify-content: center;align-items: center;">stavka$</div> <div style="width:25%;font-size:95%;align-items: center;display:flex;">numberpeop </div><div style="font-size:95%;width:25%;display:flex;align-items:center;">long min </div>';
connection.onopen = function (e) {
    console.log('Connected! '+e);
//    connection.send("auth;login;false;");
    

};
///////////////////////////////////////


//getFiguresLadia(getBoardsMas(),42);

var c = String.fromCharCode()
//////////////////////////////////////
function getBoardsMas(){
    var x=[], i, j;
    var a = 0;
for (i=0; i<8; i++){
  x.push(i);
  x[i] = [];
  for (j=0; j<8; j++){
    x[i].push(boardfigureposition[a]);
      a++;
  }
}
    
//console.log(x);
    return x;
}
 function getPosition(position){
        var pos = new Array();
        var i = Math.floor(position/8);
        var j = Math.floor((position-(i*8)));
       // System.out.println(i);
       // System.out.println(j);
        pos[0] =i;
        pos[3-2] = j;
        return pos;

    }

function reverseStr(str) {

        return str.split("").reverse().join("");

    }
function  getFiguresLadia(boards,figurePosition){
     
    var oldp = getPosition(figurePosition);
  //  int[]newp = getPosition(figurePosition[1]);
var x =oldp[0],y = oldp[1];

console.log(x);
    console.log(y);
    let right =true;
    let left = true;
    
    if(x>-1 && x<8){
        
        
        
        
        for(var i=0;i<8;i++){
            if(!(i==x)){
            console.log(boards[i][y]);
                console.log(y+".."+i);
                 if(i>x ){
                     
                    // console.log(figurePosition-(i-x));
                     //if(figurePosition-(i-x)>=0 && figurePosition-(i-x)<=7)
                     if(boards[y][i]=="1"){
                         
              //       showFigureAt(figurePosition-(i-x),"left"); 
                console.log("left null:"+(i));
                 }else{
                       if(left==true){
                   console.log("left: " + boards[y][i]);
                           left=false;
                   }
                 }
                }else if(i<x){
                    if(boards[y][i]=="1"){
                //    showFigureAt(figurePosition+(x-i),"right");
                    console.log("right null:"+(i));
                    }else if(getChessSymbol(boards[y][i])!=""){ 
                       if(right==true){
                   console.log("right: "+ boards[y][i]);
                   right=false;
                   }
                }
                }
        }
           
        }

        
    }else{
     //   return null;
    }
right=true;
    left=true;
    //if()
   // return null;
}
function conf(){
    let a = document.getElementById("cap").value;
    if(a!=null){
        connection.send("captcha;id;"+get_cookie("capid")+";"+a);
    }
}
let a = 0;
function upd(){
    if(a==0){
        a=1;
        document.getElementById("auth").style="display:none";
    document.getElementById("reg").style="display:block";
            document.getElementById("captcha").style="display:none";
    }else{
        a=0;
    document.getElementById("auth").style="display:block";
    document.getElementById("reg").style="display:none";
        document.getElementById("captcha").style="display:none;";
    }
}
// Log errors
connection.onerror = function (error) {
    alert("Соединение разорвано!");
    console.log('WebSocket Error ' + error);
};
function reg(){
    var a = document.getElementById("reguser").value;
    var b = document.getElementById("regpass").value;
    if(a!=null && b!=null){
        connection.send("register;"+a+";"+b);
    }
    
}
// Log messages from the server
connection.onmessage = function (e) {
    var b = e.data.split(";");
    console.log(e.data);
if(b[0]=="impotantMes"){
         if(b[1]=="0"){
             document.getElementById("status").innerHTML="Вам шах.";
         }else if(b[1]=="1"){
             document.getElementById("status").innerHTML="Вам мат.";
             
         }else if(b[1]=="2"){
             document.getElementById("status").innerHTML ="Не плохо,пат.";
         }else{
var c= document.getElementById("status").innerHTML="";
            
}
     
}
     if(b[0]=="error"){
         if(b[1]=="toomany"){
             alert("На данном сервере слишком много игроков ,пожалуйста,выберите другой или подождите немного времени")
         }
     }
    if(b[0] == "board"){
        if(b[3-2]=="move"){
              showFigure(''+b[2]);
            boardfigureposition = b[2];
             console.log(b[5]);
            
            if(b[5]!=null){
                document.getElementById("s"+b[4]).innerHTML="<div class='last'>&#13;</div>";
                        document.getElementById("s"+b[5]).innerHTML="<div class='end'>&#13;"+document.getElementById("s"+b[5]).innerHTML+"</div>";
                
                    //document.getElementById("s"+b[5]).innerHTML="&#10102";
                    //document.getElementById("s"+b[5]).style="background-color:green";
            }
            if(Side!=b[3]&&b[3]!="main" && b[3]!="test"){
    Move();
                var a = document.getElementById("timerGameEnemy").style="display:none";
                var b  = document.getElementById("timerGameMy").style="display:block";
                    document.getElementById('times1').innerHTML = 60;
        
                    
        }else if(Side==b[3]){
                var a  = document.getElementById("timerGameEnemy").style="display:block";
                var b  = document.getElementById("timerGameMy").style="display:none";
                    document.getElementById('times').innerHTML = 60;
            }else if(b[3]=="test"){
                
            }
            else{
                var a  = document.getElementById("timerGameEnemy").style="display:none";
                var b  = document.getElementById("timerGameMy").style="display:none";
        
            }
           
            
        }else if(b[1]=="name"){
                 document.getElementById("EnemyPanel").innerHTML=""+b[2]+"<dt>"+b[3]+"$</dt>";
                
            
            
                 }
        
        else if(f[1] == "error"){
            if(f[2]=="manypeople"){
                alert("В данном столе уже достаточное количество игроков");
            }else if(f[2] == "moneyneed"){
                alert("Недостаточно средст на счету ,пожалуйста выберите другой.")
            }
        }
  
    } else if(b[0]=="chat"){
        if(b[1]=="clear"){
                 
document.getElementById("textMessage").innerHTML="";
   
        }else if(b[1]=="reload"){
            window.location.reload();
        }else if(b[1]=="ban"){
            alert("Вы временно отключены от чата!!!");
            soundClick();
        }else if(b[1]=="server"){
       soundClick(); document.getElementById("textMessage").innerHTML=document.getElementById("textMessage").innerHTML+"<br/><span style='color:#3bd061;'>"+b[2]+"</span>";
         document.getElementById("textMessage").scrollTop += 200;
            
    }
        else{
        onMessageChat(b[2],b[1]);
        }
    }
    
    
    else if(b[0] == "account"){
         if(b[3-2]=="money"){
              var c = Number(b[2]);
               document.getElementById("money").innerHTML=" "+b[2]+"$";
         
        }
    }
    
    else if(b[0] =="tablegame"){
        
        if(b[1]=="win"){
            if(get_cookie("table")>=0){
                alert("Вы победили "+b[2]+"$");
            }
        }else if(b[1]=="exitenemy"){
            document.getElementById("EnemyPanel").innerHTML="";
        }
        else if(b[1]=="end"){
            var c = Number(b[2]);
             document.getElementById("boardid").style="display: none;";
            document.getElementById("board").style="display: none;";
               document.getElementById("money").innerHTML=" "+b[2]+"$";
         
            document.getElementById("exit").style="display: none;";
            document.getElementById("boardlistview").style="display: block;";
        } else if(b[1]=="lose"){
              alert("Вы проиграли "+b[2]+"$");
        }
    }
  else if(b[0]=="position"){
          if(b[3-2]== "board"){
        //      $('.block').on('click',MoveTouch);
              var a = Number(b[2]);
              if(a==(0) ){
                  clear();
                 Side = "white";
                //  initBoard();
                 // showFigure(boardfigureposition);
         
                 //  Move();
              }else if(a==1){
                  clear();
                  Side="black";
                 // initBlackBoard();
                //  showFigure(boardfigureposition);
                  Move();
                       }else{
                  Side ="none";
              }
              
                document.getElementById('second').innerHTML = 16;
                document.getElementById("timer").style="display: block;";
  
          }else if(b[1]=="boardreturn"){
                  var a = Number(b[2]);
              if(a==(0) ){
                  clear();
                 Side = "white";
                //  initBoard();
                //  showFigure(boardfigureposition);
            //   $('.block').on('click',movet);
                   $('.block').on('vclick',movet);
                   Move();
              }else if(a==1){
                  clear();
                  Side="black";
                  //initBlackBoard();
                  //showFigure(boardfigureposition);
                  Move();
         // $('.block').on('click',movet);
                     $('.block').on('vclick',movet);
              }else{
                  Side ="none";
              }
              
                document.getElementById('second').innerHTML = 16;
                document.getElementById("timer").style="display: none;";
          }
          }
    else if(b[0] == "auth"){
     
          if(b[1]=="true"){
          //    alert("true");
                var aaaa  = document.getElementById("user").value;
                var bbbb  = document.getElementById("pass").value;
  document.cookie="db="+aaaa;
                document.cookie="hash="+bbbb;
                document.getElementById("boardlistview").style="display: block;";
                document.getElementById("auth").style="display: none;";
               
     document.getElementById("boardid").style="display: none;";

   // document.getElementById("board").style="display: none;";
    document.getElementById("exit").style="display: none;";
    document.getElementById("Nickname").innerHTML=""+get_cookie("db");
       
            
          }
            else{
              alert("Не правильное имя или пароль");
                window.location.href(window.location.reload()+"?invalid=true");
          }
        
  
    
   
    
   }else if(b[0] == "tables"){
        if(b[1]=="all"){
           initBoardLists1(b[2],b[3],b[4],b[5]);  
        }
        else if(b[1]=="remove"){
            var c =document.getElementById(""+b[2]);
            if(c!=null)
                c.remove();
        }
       else if(b[3-2]=="upd"){
            document.getElementById(""+b[2]).innerHTML="";
            $('#'+b[2]).append(updates
                       .replace('stavka',b[5])
                        .replace('number',b[6])
                       .replace('long',b[7]/60000)
                                 .replace('name',b[3])
                                 .replace('joined',b[2]));
        }
       else if(b[1]=="exit"){
            document.getElementById("boardid").style="display: none;";
            document.getElementById("board").style="display: none;";
            document.getElementById("exit").style="display: none;";
            document.getElementById("EnemyPanel").innerHTML="";
    
            document.getElementById("boardlistview").style="display: block;";
    
    
    
        }else if(b[1]=="money"){
            document.getElementById("moneygame").innerHTML=b[2]+"$";
        }else if(b[1]=="tree"){
            document.getElementById("treegame").innerHTML=b[2]+" - trees";
        }else if(b[1]=="oil"){
            document.getElementById("oilgame").innerHTML=b[2]+" - oil";
        }
  
    }else if(b[0] =="game"){
            if(b[1]=="restart"){
                document.getElementById("board").style="display:block";
            }else if(b[1]=="enemyExit"){
                
            }
                else if(b[1]=="removetimers"){
                
                
                document.getElementById("timer").style="display:none";
            }else if(b[1]=="gamestart"){
                alert("Игра началась!");
            }
        else if(b[1]=="captcha"){
                var i = Number(b[2]);
                 document.cookie="capid="+i;
                document.getElementById("captcha").style="display:block";
                    document.getElementById("auth").style="display:none";
                    document.getElementById("reg").style="display:none";
                var code = '<img src="data:image/png;base64,'+b[3]+'">';
                document.getElementById("imgcap").innerHTML=code;
                
                
            }else if(b[1]=="outcap"){
                alert("Время вышло,данная капча больше не действительна.")
            }
            else if(b[1]=="noncaptcha"){
            alert("Капча введена неверно!");
            }else if(b[1]=="limit"){
                
                alert("Лимит введения капчи исчерпан");
                upd();
            }else if(b[1]=="unvalid"){
                if(b[2]=="login"){
                    alert("Неправильно введён логин! Mинимум 4 символа,максимум 10 символов");
}else{
    alert("Неправильно введён пароль! Mинимум 6 символов ,максимум 20");
}
            }
    else if(b[1]=="register"){
        if(b[2]=="true"){
            alert("Вы успешно зарегестрировались");
            upd();
        }else{
            alert("Выбранный вами логин уже занят");
            upd();
        }
    }
        else if(b[1]=="join"){
          
          document.cookie="table="+b[2];


Move();

          initBoard1(Number(b[3].split("x")[0]),Number(b[3].split("x")[1]))
          document.getElementById("s100000").className="block "+b[4];
                    document.getElementById("boardlistview").style="display: none;";
                document.getElementById("auth").style="display: none;";
     document.getElementById("boardid").style="display: flex;";

            document.getElementById("board").style="display: block;";
            document.getElementById("exit").style="display: block;";
           ;

    
        }else if(b[1]=="return"){
            
         if(b[2]="boards"){
                document.cookie="table="+b[3];
                    document.getElementById("boardlistview").style="display: none;";
                document.getElementById("auth").style="display: none;";
     document.getElementById("boardid").style="display: flex;";
        //    document.getElementById("board").style="display: block;";
            document.getElementById("exit").style="display: block;";
        document.getElementById("board").style="display: none;";
  
                
            }
        }else if(b[3-2]=="goodbye"){
                document.getElementById("boardid").style="display: none;";
            document.getElementById("board").style="display: none;";
            document.getElementById("exit").style="display: none;";
            document.getElementById("boardlistview").style="display: block;";
    
        }else if(b[1]=="trashboard"){
            alert("Вы не можете создавать больше 3-ёх столов в течение 3-ёх минут")
        }else if(b[3-2]=="tablelist"){
            if(b[2]=="notfound"){
                     var c =document.getElementById(""+b[3]);
            c.remove();
            alert("Стол был закрыт.");
            }
        }
    }else if(b[0]=="showFigure"){
       
             figures=   e.data.replace("showFigure;");
       
    
    }else if(b[0]=="showFigureAt"){
        showFigureAt1(b[2],b[1],b[3])
        if(b.length >4 && b[4]!=null )
         showFigureAt(b[4],'1')
    }



    Move();

     console.log('Server: ' + e.data);
}

function done(e){
    connection.send("tabless;"+get_cookie("table")+";board;Done;"+get_cookie("db")+";"+get_cookie("hash")+";true");
    document.getElementById("board").style="display: none;";
    document.getElementById("timer").style="display: none;";
    document.getElementById("exit").style="display: block;";
    
    
}
var divBlock = '<div id = "s$coord" class = "block $color"></div>';
var divFigure = '<div id="f$coord" class = "figure">$figure</div>';
var map;
var get = window
    .location
    .search
    .replace('?','')
    .split('&')
    .reduce(
        function(p,e){
            var a = e.split('=');
            p[ decodeURIComponent(a[0])] = decodeURIComponent(a[1]);
            return p;
        },
        {}
    );
$(function(){
    map = new Array();
    map[100000] = "k";
 //  initBoard();
  // showFigure('rnbqkbnrpppppppp11111111111111111111111111111111PPPPPPPPRNBQKBNR');
  
});

function clear(){
    
    
    document.getElementsByClassName("board")[0].innerHTML="";
}
function initBlackBoard(){
      for(var coord=0;coord<64;coord++){
  
       $('.board').append(divBlock
                          .replace('$coord',coord)
                          .replace('$color',isBlack(coord)?'black':'white'));
       
   }   
}
function initBoard(){
    for(var coord=63;coord>=0;coord--){
 
       $('.board').append(divBlock
                          .replace('$coord',coord)
                          .replace('$color',isBlack(coord)?'black':'white'));
       
   }
    
}
function initBoard1(w,h){
    width = w;
    height = h;
    if(w*30<=window.innerHTML){
    //document.getElementById("boardid").style="display:flex;width:"+(w*30)+"px;";
}
    var id = 0;
    document.getElementById("boardid").innerHTML="";
    var line = '<div class="line"></div>';
    for(var i = 0;i<w;i++){
        $("#boardid").append(line);
        var l = document.getElementsByClassName("line")[i];
        for(var j =0 ;j<h;j++){
            
            document.getElementsByClassName("line")[i].innerHTML+=(divBlock.replace('$coord',id
                ).replace('$color','white'));
            id++;
        }
    }
    if(figures!=null){

        showFigure1(figures);
    }
}
var width = 0;
var height = 0;

function moveFigure(frcoord,tocoord){
  
  //  console.log("move from " +frcoord +" to "+tocoord);
   // console.log("fc x:="+Math.floor(frcoord/height)+" y:="+((frcoord-(Math.floor(frcoord/height)*height))-1))

     //  console.log("tc x:="+Math.floor(tocoord/height)+" y:="+((tocoord-(Math.floor(tocoord/height)*height))-1))
       console.log("figure = "+map[frcoord]);

 figure = map[frcoord];
if(frcoord==100000){

     showFigureAt(frcoord,'1');
    showFigureAt(frcoord,figure);
}else if(figure=="b" || figure=="r" || figure=="o" ||figure=="s" || figure=="t" || figure=="f" ||figure =="c"){
     showFigureAt(frcoord,'1');
    showFigureAt(frcoord,figure);
}
else{
    showFigureAt(frcoord,'1');
    showFigureAt(tocoord,figure);
}

Move();

connection.send("tables;movefigure;"+frcoord+";"+tocoord+";"+figure);
    // MoveTouch();
    if(get_cookie("table")>=0){

        
 // connection.send("tabless;"+get_cookie("table")+";table;move;0;"+frcoord +";"+tocoord+";"+get_cookie("db")+";"+get_cookie("hash")); 
    }
   
   
}
function MoveTouch(){
    if(Side!="none" && Side=="white"|| Side=="black" && true==false){
            if(touch[1]!=null){
                
                  var tocoord = this.id.substring(1);
                if(touch[1]!=tocoord){
                 moveFigure(touch[1],tocoord);
                touch[1]=null;}
                else{
                    touch[1]=null;
                }
            }
            else if(touch[1]==null){
                var c = getChessFigureSide(boardfigureposition[Number(this.id.substr(1))],Side);
                if(c==true){
                    touch[1]= this.id.substr(1);
                }
            }
        
    }
}

        
function Move(){
     $('.figure').draggable({
  drag: function( event, ui ) {},revert: 'invalid'
});
    
    var c = document.getElementsByClassName("block");
 
    $('.block').droppable({
        drop:function(event,ui){
           
            var frcoord =ui.draggable.attr("id").substring(3-2);
            var tocoord = this.id.substring(3-2);

             moveFigure(frcoord,tocoord);
             Move();
        }
    });     

 /*  
  for(let i=0;i<c.length;i++){
c[i].addEventListener("touchstart",MoveTouch,false);
}
*/
   
}
function stop(){
   /*
    $('.block').droppable({
        drop:function(event,ui){
           
            var frcoord =ui.draggable.attr("id").substring(3-2);
            var tocoord = this.id.substring(3-2);
             moveFigure(frcoord,tocoord);
        }
    });
    */
}
function showFigure(figures){
    for(var coord=0;coord<figures.length;coord++){
    showFigureAt(coord,figures.charAt(coord));
    }
}

function showFigure1(figures){
    var g = figures.split("&");
    for(var b = 0;b<g.length-1;b++){
        var j = g[b].split(";");
       
      //  if(color=="none")color = null;
     showFigureAt1(b,j[1],j[0]);
    
    }
    /*
    for(var coord=0;coord<figures.length;coord++){
    showFigureAt(coord,figures.charAt(coord));
    }*/

}




function getChessSymbol(figure){
    switch(figure){
          //   case 'K':return '&#9812;';
             case 'Q':return '&#9813;';
          //   case 'R':return '&#9814;';
          //   case 'B':return '&#9815;';
             case 'N':return '&#9816;';
            // case 'P':return '&#9817;';
          //   case 'k':return '&#9818;';
             case 'q':return '&#9819;';
           //  case 'b':return '&#9821;';
             case 'n':return '&#9822;';
           //  case 'p':return '&#9823;';  
            case 'left':return '&#8592;'; 

case 'R':return '<img src="game/man1_lowest.png" style="width: 100%;">';

case 'o':return '<img src="game/oil.gif" style="width: 100%;">';


case 'K':return '<img src="game/man2_lowest.png" style="width: 100%;">';



case 'b':return '<img src="game/house_lowest.png" style="width: 100%;">';
         case 'B':return '<img src="game/farm3_lowest.png" style="width: 100%;">';

         case 'q':return '<img src="game/grave_lowest.png" style="width: 100%;">';

         case 'B':return '<img src="game/farm3_lowest.png" style="width: 100%;">';
             

case 'r':return '<img src="game/palm_lowest.png" style="width: 100%;">';

            case 'm':return '<img src="game/123/coin.png" style="width: 100%;">';
           
            case 'k':return '<img src="game/man3_lowest.png" style="width: 100%;">';
             case 'p':return '<img src="game/man0_lowest.png" style="width: 100%;">';
              case 'P':return '<img src="game/123/man0_lowest.png" style="width: 100%;">';
           
            case 'c':return '<img src="game/castle_lowest.png" style="width: 100%;">';

            case 's': return '<img src="game/strong_tower_lowest.png" style="width: 100%">';
            case 't': return '<img src="game/tower_lowest.png" style="width: 100%">';

            case 'right':return '&#8594;'; 
                case 'up':return '&#8593;'; 
                case 'down':return '&#8595;'; 
        default:return '&#13;';
    }
}
function exit(e){
connection.send("tabless;"+get_cookie("table")+";removeuser;"+get_cookie("db")+";"+get_cookie("hash"));
}
function showFigureAt(coord,figure){
    map[coord] = figure; 
    $('#s'+coord).html(divFigure
                      .replace('$coord',coord)
                      .replace('$figure',getChessSymbol(figure)));
    stop();
}


function showFigureAt1(coord,figure,color){
    map[coord] = figure; 
    $('#s'+coord).html(divFigure
                      .replace('$coord',coord)
                      .replace('$figure',getChessSymbol(figure)));

    if(color!="none"&& color!="undefinednone" && color!=undefined && color !=NaN&&color!=null){
        console.log(color+" "+coord);
    document.getElementById("s"+coord).className="block "+color;
    }

   // stop();
}




function isBlack(coord){
    return (coord % 8 + Math.floor(coord/8))%2;
}

        </script>
        
<script>
/*    
var boardi = '  <div id ="sid" onClick="onShow(this)" style="float:left;display:flex;" class="boardList"><div> </div><div style="width:10%;margint-top:20%;"><img src="https://kintellhome.com/wp-content/uploads/2018/10/noun_Gambling-Chip_589745_000000.png" width="100%"></div><div style="font-size:60;">stavka    numberpeop.</div><div style="font-size:80;margin-left:30%;">long min.</div></div>';
//var divFigure = '<div id="f$coord" class = "figure">$figure</div>';
//var connection = new WebSocket('ws://192.168.1.104:4444');
function initBoardLists(cool,number,stavcka,time){
       $('body').append(boardi.replace('sid',cool)
                       .replace('stavka',stavcka)
                        .replace('number',number)
                       .replace('long',time/60000));
       
   
}
   
   /* var str = '<div id="joined" value="cid" class="join"  onClick="joined(this)">join table</div>';
    function onShow(e){
     //   var c = document.getElementById(e.id+"").style="background-color:grey;";
     var b=   document.getElementsByClassName("join")[0];
        if(b!= null)
            b.remove();
         $('.panel').append(str.replace('joined',e.id));
       
    }
    function joined(e){
   // alert(e.id);
        connection.send("table;game;join;"+e.id);
    }
/*connection.onopen = function (e) {
    console.log('Connected! '+e);
   // connection.send('rnbqkbnrpppppppp11111111111111111111111111111111PPPPPPPPRNBQKBNR'); 
     
    // Send the message 'Ping' to the server
};

// Log errors
connection.onerror = function (error) {
    console.log('WebSocket Error ' + error);
};


    function create(){
        connection.send("tables;create;test;200;")
    }
    /*
// Log messages from the server
connection.onmessage = function (e) {
    var b = e.data.split(";");
    if(b[0] == "tables"){
        if(b[3-2]=="all"){
           initBoardLists(b[2],b[6],b[5],b[7]);  
        } if(b[3-2]=="remove"){
            document.getElementById(""+b[2]).remove();
        }
  
    }
    console.log('Server: ' + e.data);
    
};        
  */


function putagain(str){
    Move();
    if(str.id=="sell"){

        var p = prompt ("How many oils you wanna sell>?");
        connection.send("tables;sell;"+p)
    }else if(str.id=="buytree"){
        var p = prompt ("How many trees you wanna buy>?");
        connection.send("tables;buy;"+p)
    }
    else{
    map[100000] = str.id;
    document.getElementById("f100000").innerHTML=getChessSymbol(str.id);
}
}








</script>
	
        
        
        <style>
        
			.enemy{
				display:flex; position: absolute;top: 1%;left: 2%;float: left;border: 4px solid #55cdef;border-radius: 20px;
				width: 65%;
			} 
a{
  color: #fff;
    font-size: 100%;
 }
a:hover{
 text-decoration: none;
}
.container{
 width:92%;
 background-color: rgba(24, 33, 52, 0.7);
 margin: 40px auto 0 auto;
 text-align: center;
    border-radius: 20px 20px 20px 20px;
 box-shadow: 0 -5px 0 #3adbfd;
 padding-bottom: 0px;

}
.container .tes{
 width:60px;
 height:60px;
 margin: -30px 0 30px 0;
 border: 5px solid #1a394f;
 border-radius: 50%;
 box-shadow: 0 -5px 0 #3adbfd;
}
            
            
            .container .ter{
 width:240px;
 height:120px;
 margin: -60px 0 30px 0;
             
 border: 5px solid #1a394f;
 border-radius: 50%;
 box-shadow: 0 -5px 0 #3adbfd;
}

input[type="text"],input[type="password"]{
 width: 90%;
 height:40px;
  border-radius: 20px 20px 20px 20px;    
 font-size: 100%;
 margin-bottom: 15px;
 border-radius: 4px;
 padding-left: 40px;
}
.dws-input input:hover{
 box-shadow: 0 0 6px 3px rgba(58, 219, 253, 0.35);
}
.dws-submit {
	
 padding: 7px 20px;
 margin: 5px 0 20px 0;
 font-size: 150%;
 color: #fff;
 background-color: #2ca8c6;
 border: none;
    border-radius: 9px 9px 9px 9px;
 border-bottom: 4px solid #6ee9fd;
 cursor: pointer;
}
			
			.dws-submits {
	
 padding: 2% 4%;
 margin: 5px 0 20px 0;
position: fixed;
right:6px;
top:0.16%;
 font-size: 113%;
 color: #fff;
 background-color: #2ca8c6;
 border: none;
    border-radius: 9px 14px 9px 9px;
 border-bottom: 4px solid #6ee9fd;
 cursor: pointer;
}
			.dws-submitready {
			
	position:relative;		
 padding: 2% 4%;
top: 5%;
 font-size: 150%;
 color: #fff;
 background-color: #2ca8c6;
 border: none;
    border-radius: 9px 9px 9px 9px;
 border-bottom: 4px solid #6ee9fd;
 cursor: pointer;
}
.dws-submit:hover{
 transition: all 0.5s;
 background: #fff;
 color: #2c536c;
}
#timer{
	position: absolute;
bottom: 10px;
text-align: center;
color: #333;
	color: red;
	font-weight: bolder;
font-family: fantasy;
font-size: 65%;
cursor: default;
}

#timer div{
display: inline;
}
			
			#timerGameEnemy{
	position: relative;
margin-top:20%;
text-align: center;
color: #333;
	color: red;
	font-weight: bolder;
font-family: fantasy;
font-size: 65%;
cursor: default;
}

#timerGameEnemy div{
display: inline;
}
			
			
			
						#timerGameMy{
	position: relative;
margin-top: 20%;
text-align: center;
color: #333;
	color: red;
	font-weight: bolder;
font-family: fantasy;
font-size: 65%;
cursor: default;
}
						#status{
	position: relative;
margin-top: 20%;
text-align: center;
color: #333;
	color: red;
	font-weight: bolder;
font-family: fantasy;
font-size: 65%;
cursor: default;
}

			
#timerGameMy div{
display: inline;
}
.dws-input::before{
 font-family: "FontAwesome";
 content: "\f007";
 position: absolute;
 font-size: 100%;
 padding: 3% 0 0 7px;
 color: #2c536c;
}
.dws-input:nth-child(2)::before{
content: "\f023";
    
}
.dws-input:hover::before{
 color: #319ebc;
 transition: all 0.3s;
}
.dws-social i{
 color: #fff;
 font-size: 20px;
 width: 20px;
 padding: 10px;
}
.boardlistview{
    margin-top: 13%;
}
.dws-social i:hover{
 background-color: #fff;
 color: #1a394f;
 border-radius: 5px;
 cursor: pointer;
}

.boughtpanel{
    overflow-y: auto;
    border: 6px solid #55cdef;
    position: absolute;;
    width: calc(20% - 18px);
    right: 0px;
    top: 0px;
    height: calc(100% - 12px);
    background-color: beige;

}

.stl{
   /* margin-left: calc(80% + 30px);*/
   margin-top: 5px;
   margin-left: 6px;

}



        </style>
        
         <div id="boardlistview" class ="boardlistview" style="display: none;display: none;" >
             
               <div style="display: flex;position:fixed;width: 100%;height:12%;top:0px;left:0px;background-color: #55b3ce;justify-content: flex-start;"><img class="ter" src="https://dwstroy.ru/lessons/les3373/demo/img/men.png" style="margin-top:0%;" height="100%"><a id="Nickname">Admin </a><a id="money" style="margin-left: 25px;"> 20000000$</a>
   </div>
   <center><h1  style="font-size:150%;margin-bottom: 0px;align-items: center;"> Список столов </h1></center>
        <div class="panel" ><div class="createtable" style="justify-content: center; display: flex;align-items: center;" onClick="create()" >Создать стол</div>
         <div class="view" style="display: none;align-items: center;" >Смотреть</div>   
                </div>    
        
        </div>
        
        
        <div id="auth">
        <div class="container" >
    <img  class="tes" src="https://dwstroy.ru/lessons/les3373/demo/img/men.png">
            <br/>
            <a href="#"> #ЛУЧШЕДОМА</a>
            <br/>
            <div class="dws-input">
        
            <input type="text" id="user" name="username"  placeholder="логин">
        </div>
        <div class="dws-input">
            <input type="password" id="pass" name="password"  placeholder="Пароль">
        </div>
            <button class="dws-submit"  onClick="auth(this); return false;" >Войти</button><br />
        <a href="#" onClick="upd()">Зарегестрироваться</a>
   
            <br/>
            2020&copy;
</div>
       
      
        </div>
		
		
		
		
		
		
		
		
		
		
		
		
		 <div id="reg" style="display:none;">
        <div class="container" >
    <img  class="tes" src="https://dwstroy.ru/lessons/les3373/demo/img/men.png">
            <br/>
            <a href="#"> #ЛУЧШЕДОМА</a>
            <br/>
            <div class="dws-input">
        
            <input type="text" id="reguser" name="username"  placeholder="Придумайте логин">
        </div>
        <div class="dws-input">
            <input type="password" id="regpass" name="password"  placeholder="Придумайте пароль">
        </div>
            <button class="dws-submit"  onClick="reg(); return false;" >Регистрация</button><br />
        <a href="#" onClick="upd()">Войти</a>
   
  
            <br/>
               2020&copy;
</div>
       
      
        </div>
     
		
		
		
		
		
			 <div id="captcha" style="display:none;">
        <div class="container" >
    <img  class="tes" src="https://dwstroy.ru/lessons/les3373/demo/img/men.png">
            <br/>
            <a href="#"> #ЛУЧШЕДОМА</a>
            <br/>
            <div class="dws-input">
        
            <input type="number" id="cap" name="username"  placeholder="Введите число">
				<br>
				<div id="imgcap"></div>
        </div>
       
            <button class="dws-submit"  onClick="conf(); return false;" >Ввести</button><br />
       
   

            <br/>
            
</div>
       
      
        </div>
     
           
     <div class = "board" id = "boardid" style="display:none;">
      
    </div>
<div class="stl">
<div id="s100000" class="block black">

           <div class="figure" id ="f100000">
                <img src="game/man3_lowest.png" width="100%">

           </div>


       </div>

       <button id="b" onclick="putagain(this)">
           <img src="game/house_lowest.png" style="width: 35px;">
           
       </button>


       <button id="k" onclick="putagain(this)">
           <img src="game/man3_lowest.png" style="width: 35px;">
           
       </button>
          <button id="p" onclick="putagain(this)">
           <img src="game/man0_lowest.png" style="width: 35px;">
           
       </button>



        <button id="B" onclick="putagain(this)">
           <img src="game/farm3_lowest.png" style="width: 35px;">
           
       </button>



       <button id="K" onclick="putagain(this)"> 
           <img src="game/man2_lowest.png" style="width: 35px;">
           
       </button>




       <button id="P" onclick="putagain(this)">
           <img src="game/123/man0_lowest.png" style="width: 35px;">
           
       </button>

       <button id="R" onclick="putagain(this)">
           <img src="game/man1_lowest.png" style="width: 35px;">
           
       </button>










        <button id="t" onclick="putagain(this)">
           <img src="game/tower_lowest.png" style="width: 35px;">
           
       </button>

       <button id="s" onclick="putagain(this)">
           <img src="game/strong_tower_lowest.png" style="width: 35px;">
           
       </button>


       <button id="c" onclick="putagain(this)">
           <img src="game/castle_lowest.png" style="width: 35px;">
           
       </button>
         <button id="o" onclick="putagain(this)">
           <img src="game/oil.jpg" style="width: 35px;">
           
       </button>

       <button id="sell" onclick="putagain(this)">
           sell oil
           
       </button>

        <button id="buyoil" onclick="putagain(this)">
           buy oil
           
       </button>

        <button id="buytree" onclick="putagain(this)">
           buy tree
           
       </button>

<div id ="moneygame">
    10.5$
</div>

<div id ="treegame">
    0 - tree
</div>
<div id ="oilgame">
    0 - bars
</div>
<div id ="irongame">
    0 - tonns
</div>



   </div>

      
 
		<div id="lastmove">&#13;</div>
    </body>
</html>